<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë‚´ í˜„ì¬ ìœ„ì¹˜ ë³´ê¸° â€” ì§„ë‹¨ ëª¨ë“œ</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body{background:#0d1117;color:#e6edf3;font-family:system-ui, -apple-system, "Noto Sans KR", sans-serif;margin:0;padding:20px;text-align:center}
    h1{color:#58a6ff;margin:0 0 12px}
    #info{background:rgba(255,255,255,0.03);padding:12px;border-radius:10px;display:inline-block;text-align:left;min-width:320px}
    #console{margin-top:12px;text-align:left;max-width:900px;white-space:pre-wrap;font-family:monospace;font-size:13px;color:#ffdcdc}
    #map{width:90%;max-width:900px;height:400px;margin:18px auto;border-radius:10px;overflow:hidden}
    .btn{margin-top:10px;padding:8px 12px;border-radius:8px;border:none;background:#238636;color:white;cursor:pointer}
    .warn{color:#ffb86b}
  </style>
</head>
<body>
  <h1>ë‚´ í˜„ì¬ ìœ„ì¹˜ ë³´ê¸° â€” ì§„ë‹¨ ëª¨ë“œ</h1>
  <div id="info">
    <div id="status">ğŸ’¡ í˜ì´ì§€ ë¡œë“œ: ìœ„ì¹˜ ìš”ì²­ì„ ìë™ìœ¼ë¡œ ì‹œë„í•©ë‹ˆë‹¤...</div>
    <div style="margin-top:8px">
      <button class="btn" id="retryBtn">ë‹¤ì‹œ ê¶Œí•œ ìš”ì²­í•˜ê¸°</button>
      <button class="btn" id="showConsoleBtn" style="background:#0b5fff">ì½˜ì†” ì—´ì–´ ì•ˆë‚´ ë³´ê¸°</button>
    </div>
    <div style="margin-top:8px;font-size:13px;color:#9aa4b2">
      (ì°¸ê³ ) GitHub PagesëŠ” HTTPSì—¬ì•¼ ê¶Œí•œì°½ì´ ëœ¹ë‹ˆë‹¤. í™•ì‹¤íˆ HTTPSë¡œ ì ‘ì†í–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
    </div>
  </div>

  <div id="map"></div>

  <div id="console" aria-live="polite"></div>

  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // ìœ í‹¸: í™”ë©´ + ì½˜ì†”ì— ë¡œê·¸ ë‚¨ê¸°ê¸°
    const logEl = document.getElementById('console');
    function log(...args){
      console.log(...args);
      const s = args.map(a => (typeof a === 'object' ? JSON.stringify(a) : String(a))).join(' ');
      logEl.textContent += s + "\\n";
    }
    function setStatus(txt, isWarn){
      const st = document.getElementById('status');
      st.innerHTML = (isWarn ? '<span class=\"warn\">' + txt + '</span>' : txt);
      log('STATUS:', txt);
    }

    // ì§€ë„ ì´ˆê¸°í™” (ë¹ˆ ë·°)
    let map = L.map('map', { center: [20, 0], zoom: 2, attributionControl: false });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
    let marker;

    async function requestLocation(showPopupImmediately = true){
      setStatus('ğŸ“¡ ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­ ì¤‘...');
      log('navigator.geolocation supported?', !!navigator.geolocation);

      if(!navigator.geolocation){
        setStatus('âŒ ì´ ë¸Œë¼ìš°ì €ëŠ” Geolocationì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', true);
        return;
      }

      // ì˜µì…˜: ìµœëŒ€ 15ì´ˆ ëŒ€ê¸°, ì •í™•ë„ í—ˆìš©
      const opts = { enableHighAccuracy: true, timeout: 15000, maximumAge: 0 };

      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          const acc = pos.coords.accuracy;
          setStatus(`âœ… ìœ„ì¹˜ íšë“: ìœ„ë„ ${lat.toFixed(6)}, ê²½ë„ ${lon.toFixed(6)} (ì •í™•ë„ Â±${Math.round(acc)}m)`);
          log('POSITION SUCCESS', pos);
          if(marker) marker.setLatLng([lat, lon]);
          else marker = L.marker([lat, lon]).addTo(map);
          map.setView([lat, lon], 15);
          if(showPopupImmediately) marker.bindPopup('ğŸ“ í˜„ì¬ ìœ„ì¹˜').openPopup();
        },
        (err) => {
          // ì—ëŸ¬ ì½”ë“œ í•´ì„
          const codes = {1:'ê¶Œí•œ ê±°ë¶€(PERMISSION_DENIED)',2:'ìœ„ì¹˜ ì •ë³´ ì œê³µ ë¶ˆê°€(POSITION_UNAVAILABLE)',3:'ìš”ì²­ ì‹œê°„ ì´ˆê³¼(TIMEOUT)'};
          const msg = codes[err.code] || 'ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬';
          setStatus('ğŸš« ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + msg, true);
          log('POSITION ERROR', err);
          // ì¶”ê°€ ì•ˆë‚´
          if(err.code === 1){
            log('ê¶Œí•œ ê±°ë¶€: ë¸Œë¼ìš°ì €ì˜ ì‚¬ì´íŠ¸ ê¶Œí•œ(ë˜ëŠ” OS ì„¤ì •)ì—ì„œ ìœ„ì¹˜ ì‚¬ìš©ì„ í—ˆìš©í•˜ì„¸ìš”.');
          } else if(err.code === 2){
            log('ìœ„ì¹˜ ì œê³µ ë¶ˆê°€: ë””ë°”ì´ìŠ¤ì˜ ìœ„ì¹˜ ì„œë¹„ìŠ¤(GPS)ê°€ êº¼ì ¸ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
          } else if(err.code === 3){
            log('íƒ€ì„ì•„ì›ƒ: ìœ„ì¹˜ íƒìƒ‰ì— ì‹œê°„ì´ ê±¸ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');
          }
        },
        opts
      );
    }

    // ìë™ ì‹œë„ (í˜ì´ì§€ ë¡œë“œ ì§í›„)
    window.addEventListener('load', ()=> {
      log('í˜ì´ì§€ ë¡œë“œ - ìë™ìœ¼ë¡œ ìœ„ì¹˜ ìš”ì²­ ì‹œë„');
      // ìë™ ì‹œë„ í›„ì—ë„ ê¶Œí•œ íŒì—…ì´ ëœ¨ì§€ ì•Šìœ¼ë©´ retry ë²„íŠ¼ ì‚¬ìš©
      requestLocation(false);
    });

    // ë²„íŠ¼ ì—°ê²°
    document.getElementById('retryBtn').addEventListener('click', ()=> {
      log('ì‚¬ìš©ì ìš”ì²­: ë‹¤ì‹œ ê¶Œí•œ ìš”ì²­');
      requestLocation(true);
    });
    document.getElementById('showConsoleBtn').addEventListener('click', ()=> {
      alert('ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬(F12) â†’ Console íƒ­ì„ ì—´ì–´ ì¶”ê°€ ì—ëŸ¬ë¥¼ í™•ì¸í•˜ì„¸ìš”. ì—¬ê¸° ì¶œë ¥ì°½ì—ë„ ë¡œê·¸ë¥¼ ë‚¨ê²¼ìŠµë‹ˆë‹¤.');
    });

    // ìœ ì €ì—ê²Œ ë°”ë¡œ ë³´ì¼ ìˆ˜ ìˆëŠ” ì§§ì€ ë„ì›€ë§
    log('ì§„ë‹¨ ì‹œì‘:\\n1) HTTPSë¡œ ì ‘ì†ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.\\n2) íŒì—…ì´ ì•ˆ ëœ¨ë©´ ë¸Œë¼ìš°ì € ì£¼ì†Œì°½ ì˜†ì— ìë¬¼ì‡  ì•„ì´ì½˜ í´ë¦­ â†’ ì‚¬ì´íŠ¸ ì„¤ì • â†’ ìœ„ì¹˜ í—ˆìš©ìœ¼ë¡œ ë°”ê¿”ë³´ì„¸ìš”.\\n3) í™•ì¥ í”„ë¡œê·¸ë¨(ì˜ˆ: íŠ¸ë˜ì»¤ ì°¨ë‹¨)ì´ ìœ„ì¹˜ ê¶Œí•œì„ ë§‰ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ì‹œì ìœ¼ë¡œ ë¹„í™œì„±í™”í•˜ê³  ì¬ì‹œë„í•˜ì„¸ìš”.');
  </script>
</body>
</html>
